<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nami's Brain</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="drawer_styles.css">
</head>

<body class="h-screen overflow-hidden flex flex-col p-4 md:p-6 lg:p-8" style="margin-left: 60px;">
    <nav class="debug-nav">
        <button class="debug-nav-btn" data-drawer="memories" data-tooltip="Memories"
            onclick="openDebugDrawer('memories')">
            üíæ
        </button>
        <button class="debug-nav-btn" data-drawer="active_user" data-tooltip="Active User"
            onclick="openDebugDrawer('active_user')">
            üë§
        </button>
        <button class="debug-nav-btn" data-drawer="interest_graph" data-tooltip="Interest Graph"
            onclick="openDebugDrawer('interest_graph')">
            üìà
        </button>
        
        <div class="w-8 h-px bg-gray-700 my-2"></div>

        <button class="debug-nav-btn" data-drawer="thread_stats" data-tooltip="Thread Stats"
            onclick="openDebugDrawer('thread_stats')">
            üßµ
        </button>
        <button class="debug-nav-btn" data-drawer="prompt_debug" data-tooltip="Prompt Debug"
            onclick="openDebugDrawer('prompt_debug')">
            üß†
        </button>
        <button class="debug-nav-btn" data-drawer="run_tests" data-tooltip="Run Tests"
            onclick="openDebugDrawer('run_tests')">
            üß™
        </button>
        <button class="debug-nav-btn" data-drawer="interrupt_test" data-tooltip="Interrupt Test"
            onclick="openDebugDrawer('interrupt_test')">
            üõë
        </button>
    </nav>
    <div class="max-w-screen-2xl mx-auto w-full flex flex-col flex-1 min-h-0">
        <header class="mb-4 flex-shrink-0">
            <div class="flex justify-between items-center mb-3">
                <h1 class="text-3xl font-bold text-white">Director Engine <span
                        class="text-sm font-medium text-gray-400">| Context Monitor</span></h1>
                <div class="flex gap-3">
                    <div id="state-pill"
                        class="px-4 py-2 border-2 border-gray-600 bg-gray-800 rounded-full font-bold text-lg flex items-center gap-2">
                        <span>üó£Ô∏è</span> <span id="state-text">IDLE</span>
                    </div>
                    <div id="mood-pill"
                        class="px-4 py-2 border-2 rounded-full font-bold text-lg mood-Neutral flex items-center gap-2">
                        <span>üé≠</span> <span id="mood-text">Neutral</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 items-center bg-[#2a2a2a] border border-[#444] rounded-lg p-3">
                <div class="flex items-center gap-2">
                    <button id="streamer-lock-btn" class="lock-btn" onclick="toggleStreamerLock()"
                        title="Lock/Unlock AI auto-fill">
                        üîì
                    </button>
                    <label for="streamer-select" class="text-sm text-gray-400 whitespace-nowrap">üì∫ Watching:</label>
                    <select id="streamer-select"
                        class="bg-[#1a1a1a] border border-[#555] rounded px-3 py-1.5 text-white text-sm focus:outline-none focus:border-purple-500">
                        <option value="peepingotter">PeepingOtter</option>
                    </select>
                </div>

                <div class="flex items-center gap-2 flex-1">
                    <button id="context-lock-btn" class="lock-btn" onclick="toggleContextLock()"
                        title="Lock/Unlock AI auto-fill">
                        üîì
                    </button>
                    <label for="context-input" class="text-sm text-gray-400 whitespace-nowrap">üìù Context:</label>
                    <input type="text" id="context-input" placeholder="e.g., Otter is currently playing Phasmophobia..."
                        maxlength="120"
                        class="flex-1 bg-[#1a1a1a] border border-[#555] rounded px-3 py-1.5 text-white text-sm placeholder-gray-500 focus:outline-none focus:border-purple-500">
                    <span id="context-char-count" class="text-xs text-gray-500 w-12 text-right">0/120</span>
                    <button id="context-submit"
                        class="bg-purple-600 hover:bg-purple-700 px-4 py-1.5 rounded text-sm font-medium transition-colors">
                        Set
                    </button>
                </div>

                <div id="ai-suggestion-indicator" class="hidden items-center gap-2 text-xs">
                    <span class="text-purple-400">ü§ñ AI:</span>
                    <span id="ai-suggestion-text" class="text-purple-300 max-w-xs truncate"></span>
                    <button id="accept-ai-suggestion"
                        class="bg-purple-600/50 hover:bg-purple-600 px-2 py-0.5 rounded text-xs transition-colors">
                        Accept
                    </button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 flex-1 min-h-0">

            <div class="flex flex-col gap-6 min-h-0">

                <div id="directive-panel"
                    class="panel flex-none min-h-0 bg-gradient-to-b from-[#2a2a2a] to-[#202020] border-purple-900/50">
                    <h2 class="panel-title text-purple-300 border-b border-purple-900/30">‚ö° Director's Orders</h2>
                    <div class="panel-content flex flex-col gap-3">
                        <div>
                            <div class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Objective</div>
                            <div id="dir-objective" class="text-lg font-bold text-white leading-tight">Waiting...</div>
                        </div>
                        <div>
                            <div class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Required Tone
                            </div>
                            <div id="dir-tone" class="text-sm text-purple-200">Waiting...</div>
                        </div>
                        <div>
                            <div class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Action</div>
                            <div id="dir-action" class="text-sm text-gray-300 italic">Waiting...</div>
                        </div>
                        <div id="dir-constraints-box" class="hidden p-2 bg-red-900/20 border border-red-900/50 rounded">
                            <div class="text-[10px] uppercase tracking-widest text-red-400 font-bold">Constraints</div>
                            <div id="dir-constraints" class="text-xs text-red-200"></div>
                        </div>
                    </div>
                </div>

                <div id="summary-panel" class="panel flex-1 min-h-0">
                    <h2 class="panel-title">üß† Situation Summary</h2>
                    <div class="panel-content">
                        <div class="summary-text" id="summary-text">Waiting for summary...</div>
                        <div class="summary-raw-context" id="summary-raw-context">Raw context...</div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-6 min-h-0">
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">üëÅÔ∏è Vision (12s)</h2>
                    <div class="panel-content">
                        <div id="vision-context" class="context-box text-xs text-gray-300">Waiting...</div>
                    </div>
                </div>
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">üé§ Speech (30s)</h2>
                    <div class="panel-content">
                        <div id="spoken-word-context" class="context-box text-xs text-gray-300">Waiting...</div>
                    </div>
                </div>
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">üîä Audio (12s)</h2>
                    <div class="panel-content">
                        <div id="audio-context" class="context-box text-xs text-gray-300">Waiting...</div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-6 min-h-0">
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">üí¨ Chat</h2>
                    <div id="twitch-messages" class="panel-content text-sm log-list"></div>
                </div>
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ü§ñ Nami's Brain</h2>
                    <div id="nami-replies" class="panel-content text-sm log-list"></div>
                </div>
            </div>

            <div class="flex flex-col gap-6 min-h-0">

                <div id="metrics-panel" class="panel flex-none min-h-0">
                    <h2 class="panel-title flex justify-between">
                        <span>üéõÔ∏è Brain Metrics</span>
                        <span id="adaptive-state-label"
                            class="text-xs bg-gray-700 px-2 py-1 rounded text-gray-300">Initializing</span>
                    </h2>
                    <div class="panel-content space-y-4">
                        <div>
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Social Battery</span>
                                <span id="battery-value">100%</span>
                            </div>
                            <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                                <div id="battery-bar" class="h-full bg-green-500 transition-all duration-500"
                                    style="width: 100%"></div>
                            </div>
                        </div>

                        <div class="border-t border-gray-700 pt-3">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Attention Threshold</span>
                                <span id="threshold-value">0.90</span>
                            </div>
                            <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                                <div id="threshold-bar" class="h-full bg-blue-500 transition-all duration-500"
                                    style="width: 90%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>Velocity</span>
                                    <span id="velocity-value">0/m</span>
                                </div>
                                <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                                    <div id="velocity-bar" class="h-full bg-purple-500 transition-all duration-500"
                                        style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>Hype</span>
                                    <span id="energy-value">0.0</span>
                                </div>
                                <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                                    <div id="energy-bar" class="h-full bg-yellow-500 transition-all duration-500"
                                        style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="dynamics-panel" class="panel flex-none min-h-0">
                    <h2 class="panel-title">üåä Flow Dynamics</h2>
                    <div class="panel-content grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-xs text-gray-500 uppercase font-bold mb-1">Current Flow</div>
                            <div id="flow-text" class="text-sm font-medium text-blue-300 truncate">Reading...</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500 uppercase font-bold mb-1">User Intent</div>
                            <div id="intent-text" class="text-sm font-medium text-purple-300 truncate">Reading...</div>
                        </div>
                    </div>
                </div>

                <div id="prediction-panel" class="panel flex-1 min-h-0">
                    <h2 class="panel-title">üîÆ Anticipation</h2>
                    <div class="panel-content bg-[#252525]">
                        <p id="prediction-text" class="prediction-text text-sm text-gray-300 italic">Observing flow...
                        </p>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <div id="context-drawer-overlay" class="fixed inset-0 bg-black/50 hidden z-40" onclick="closeDrawer()"></div>
    <aside id="context-drawer"
        class="fixed top-0 right-0 h-screen w-full max-w-md translate-x-full transition-transform duration-200 ease-out bg-[#2a2a2a] border-l border-[#444] shadow-xl flex flex-col z-50">
        <div class="p-3 border-b border-[#444] flex justify-between items-center">
            <h3 class="text-sm font-semibold text-white">Nami Prompt Details</h3>
            <button onclick="closeDrawer()" class="text-gray-400 hover:text-white">‚úï</button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <div class="mb-4">
                <h4 class="text-gray-400 text-xs uppercase mb-1">Prompt</h4>
                <pre id="drawer-sent"
                    class="bg-[#111] p-2 text-sm text-gray-300 whitespace-pre-wrap rounded border border-[#333]"></pre>
            </div>
            <div>
                <h4 class="text-gray-400 text-xs uppercase mb-1">Response</h4>
                <pre id="drawer-reply"
                    class="bg-[#111] p-2 text-sm text-gray-300 whitespace-pre-wrap rounded border border-[#333]"></pre>
            </div>
        </div>
    </aside>

    <div id="debug-drawer-overlay" class="debug-drawer-overlay"></div>
    <aside id="debug-drawer" class="debug-drawer">
        <div id="debug-drawer-content" class="h-full flex flex-col"></div>
    </aside>

    <script src="script.js?v=6"></script>
    <script src="drawer_controller.js"></script>
</body>

</html>