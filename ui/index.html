<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nami's Brain</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>

<body class="h-screen overflow-hidden flex flex-col p-4 md:p-6 lg:p-8">
    <div class="max-w-screen-2xl mx-auto w-full flex flex-col flex-1 min-h-0">
        <header class="mb-6 flex-shrink-0 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">Director Engine <span class="text-sm font-medium text-gray-400">| Context Monitor</span></h1>
            </div>
            <div id="mood-pill" class="px-4 py-2 border-2 rounded-full font-bold text-lg mood-Neutral flex items-center gap-2">
                <span>ğŸ­</span> <span id="mood-text">Neutral</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 flex-1 min-h-0">
            
            <div class="flex flex-col gap-6 min-h-0">
                <div id="summary-panel" class="panel h-1/3 min-h-0">
                    <h2 class="panel-title">ğŸ§  Current Summary</h2>
                    <div class="panel-content">
                        <div class="summary-text" id="summary-text">Waiting for summary...</div>
                        <div class="summary-raw-context" id="summary-raw-context">Raw context...</div>
                    </div>
                </div>
                
                <div id="interest-graph-panel" class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ“ˆ Interest Graph</h2>
                    <div class="panel-content flex flex-col">
                        <div class="flex-1 relative" style="width:100%; min-height: 120px;"> 
                            <canvas id="interest-chart"></canvas>
                        </div>
                        <pre id="graph-data-log" class="text-xs text-gray-400 flex-none h-32 overflow-y-auto pt-2 border-t border-gray-700 mt-2">
[Waiting for scores...]</pre>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-6 min-h-0">
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ‘ï¸ Vision (12s)</h2>
                    <div class="panel-content"><pre id="vision-context" class="context-box text-xs text-gray-300">Waiting...</pre></div>
                </div>
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ¤ Speech (30s)</h2>
                    <div class="panel-content"><pre id="spoken-word-context" class="context-box text-xs text-gray-300">Waiting...</pre></div>
                </div>
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ”Š Audio (12s)</h2>
                    <div class="panel-content"><pre id="audio-context" class="context-box text-xs text-gray-300">Waiting...</pre></div>
                </div>
            </div>

            <div class="flex flex-col gap-6 min-h-0">
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ’¬ Chat</h2>
                    <div id="twitch-messages" class="panel-content text-sm log-list"></div>
                </div>
                <div class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ¤– Nami's Brain</h2>
                    <div id="nami-replies" class="panel-content text-sm log-list"></div>
                </div>
            </div>

            <div class="flex flex-col gap-6 min-h-0">
                <div id="prediction-panel" class="panel flex-none min-h-0">
                    <h2 class="panel-title">ğŸ”® Anticipation</h2>
                    <div class="panel-content bg-[#252525]">
                        <p id="prediction-text" class="prediction-text">Observing flow...</p>
                    </div>
                </div>

                <div id="user-panel" class="panel flex-none min-h-0">
                    <h2 class="panel-title">ğŸ‘¤ Active User</h2>
                    <div class="panel-content" id="user-content">
                        <p class="text-gray-500 italic text-sm text-center">No active user context.</p>
                    </div>
                </div>

                <div id="memory-panel" class="panel flex-1 min-h-0">
                    <h2 class="panel-title">ğŸ’¾ Memories</h2>
                    <div class="panel-content">
                        <ul id="memory-list" class="space-y-3">
                            <li class="text-gray-500 italic text-sm text-center">Waiting for highlights...</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <div id="context-drawer-overlay" class="fixed inset-0 bg-black/50 hidden z-40" onclick="closeDrawer()"></div>
    <aside id="context-drawer" class="fixed top-0 right-0 h-screen w-full max-w-md translate-x-full transition-transform duration-200 ease-out bg-[#2a2a2a] border-l border-[#444] shadow-xl flex flex-col z-50">
        <div class="p-3 border-b border-[#444] flex justify-between items-center">
            <h3 class="text-sm font-semibold text-white">Nami Prompt Details</h3>
            <button onclick="closeDrawer()" class="text-gray-400 hover:text-white">âœ•</button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <div class="mb-4"><h4 class="text-gray-400 text-xs uppercase mb-1">Prompt</h4><pre id="drawer-sent" class="bg-[#111] p-2 text-sm text-gray-300 whitespace-pre-wrap rounded border border-[#333]"></pre></div>
            <div><h4 class="text-gray-400 text-xs uppercase mb-1">Response</h4><pre id="drawer-reply" class="bg-[#111] p-2 text-sm text-gray-300 whitespace-pre-wrap rounded border border-[#333]"></pre></div>
        </div>
    </aside>

    <script src="script.js"></script>
</body>
</html>